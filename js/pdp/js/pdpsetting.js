var pdp_setting=jQuery.noConflict();pdp_setting.fn.ForceNumericOnly=function(){return this.each(function(){pdp_setting(this).keydown(function(e){var t=e.charCode||e.keyCode||0;return 8==t||9==t||46==t||t>=37&&40>=t||t>=48&&57>=t||t>=96&&105>=t})})},pdp_setting(document).ready(function(e){function t(e){function t(e){return isNaN(e)?"00":i[(e-e%16)/16]+i[e%16]}var a=e.split("(");if("rgb"==a[0]){var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+t(e[1])+t(e[2])+t(e[3])}return e}var a,n,s=e("#url_site").val().replace("index.php/",""),o=[],r=1e3,c=e("#currency_symbol").val(),d={},l=top.document;PDPsetting={add_html:function(){e("body").prepend('<div class="pdploading nodisplay"><span>Please wait...</span></div>'),e("body").append('<div style="display:none;" class="nodisplay" id="save_original_img_text"></div><div id="pdp_canvas_result" class="nodisplay"></div>'),e("#product-image-wrap").prepend('<img id="main_image" src="'+s+'media/pdp/images/no_image.jpg" />'),e(".wrapper_pdp").append(e(".color_content")),e(".wrapper_pdp .wrap_pdp_design").append('<div id="pdp_info_item"><ul></ul></div>'),e(".wrapper_pdp .wrap_pdp_design").append('<div id="pdp2_canvas_layer"><canvas id="pdp2_canvas_layer_cv"></canvas></div>')},edit_cart_item:function(){},center_design_area:function(){e("#main_image").load(function(){var t=e(".wrap_pdp_design").width(),a=e("#main_image").width(),i=parseInt((t-a)/2);e("#product-image-wrap").css("margin-left",i+"px")})},position_color:function(){var t=e("body").width(),a=e(".wrapper_pdp").width(),i=e(".color_content_wrap").width(),n=(t-a)/2-i+a;e(".color_content_wrap").css("left",n+"px")},change_color:function(){e("#pdp_side_items li").each(function(){var t=e(this).attr("tab"),a=e("#pdp_media_url").val(),i=e(".design-color-image li.active").attr(t);e(this).attr("side_img",i).children("img").attr("src",a+i),e(".pdp_info_save[alt="+t+"]").attr("side_img",i)}),PDPsetting.change_image()},save_first_design:function(){},handle_files_select:function(t){for(var a,i=t.target.files,n=0;a=i[n];n++)if(a.type.match("image.*")){var s=new FileReader;s.onload=function(t){return function(a){var i=e("#lists_img_upload span").length,n=document.createElement("span");n.innerHTML=['<img id="img_up_'+i++ +'" color="" class="thumb" src="',a.target.result,'" title="',escape(t.name),'"/>'].join(""),document.getElementById("lists_img_upload").insertBefore(n,null)}}(a),s.readAsDataURL(a)}e("#files_upload").val("")},change_image:function(){var t=e("#pdp_side_items li.active").attr("side_img"),a=e("#pdp_media_url").val();e("#main_image").attr("src",a+t).load(function(){canvasEvents.renderall()})},change_side:function(){var t=e("#pdp_side_items li.active"),a=t.attr("side_img"),i=t.attr("tab"),n=(e("#pdp_info_"+i).val(),e("#pdp_media_url").val()),s=t.attr("inlay").split(",");e("#main_image").attr("src",n+a),e("#wrap_inlay").css({width:s[0]+"px",height:s[1]+"px",top:s[2]+"px",left:s[3]+"px"}).show()},display_design_as_html:function(){},init:function(){function p(e,t,a,i){var n=i/a;return a>=e&&1>=n?(a=e,i=a*n,i*=.9,a*=.9):i>=t&&(i=t,a=i/n,i*=.9,a*=.9),{width:a,height:i}}canvasEvents={objectSelected:function(){var t=a.getActiveObject();canvasEvents.showinfo(),"text"==t.type?canvasEvents.changeToEditText(t):canvasEvents.changeToEditItem(),e("#pdp_info_item li.active").removeClass("active"),e('#pdp_info_item li[rel="'+t.name+'"]').addClass("active"),e("#edit_item_wrap").addClass("active"),e("#edit_item_wrap .item:not(#edit_text, #color_item)").css("opacity",1)},removeShadow:function(){var e=a.getActiveObject();e&&(e.setShadow("none"),canvasEvents.resetShadowForm(),canvasEvents.renderall())},showinfo:function(){var t=a.getActiveObject();t&&(e("#pdp_info_item").show(),e("#pdp_info_item ."+t.name+" .item_size").html(parseInt(t.currentWidth)+" x "+parseInt(t.currentHeight)))},makelistcolor:function(t,n){for(t=""!=t&&void 0!=t?t.split(","):"",e(".pdp_color_list ul").hide(),e(".pdp_color_list .pdp_color_png").show(),0==e(".pdp_color_list .pdp_color_png").length&&(e("#pdp_color_fill .pdp_color_list").append('<ul class="pdp_color_png"></ul>'),e(".pdp_color_png").on("click","a",function(){e(".pdp_color_png .active").removeClass("active"),e(this).addClass("active");var t=a.getActiveObject(),i=t.top,n=t.angle,o=t.width,r=t.height,c=t.scaleX,d=t.scaleY,l=t.left,p=t.icolor,_=t.id,v=t.name,h=s+"media/pdp/images/artworks/"+e(this).attr("rel");a.remove(t),fabric.Image.fromURL(h,function(e){e.set({left:l,top:i,angle:n,scaleX:c,scaleY:d,icolor:p,id:_,isrc:h,name:v,width:o,height:r,padding:setting.padding}),e.transparentCorners=!0,e.cornerSize=10,a.add(e).setActiveObject(e)}),a.renderAll()})),i=0;i<t.length;i++){var o=t[i].split("__");e(".pdp_color_list ul.pdp_color_png").append('<li alt="'+n+'"><a title="" rel="'+o[1]+'" style="background-color:#'+o[0]+'">'+o[1]+"</a></li>")}0==e("ul.pdp_color_png li:visible").length?e(".nomore_color").show():e(".nomore_color").hide()},addlayer_first_time:function(){var t,a=0;e("#pdp_side_items li").each(function(){var i=JSON.parse(o[e(this).index()]),n=i.objects,s=0,r=e(this).attr("tab");e(".layer_"+r+" .layer_pricing tbody").html("");for(var d=0;d<n.length;d++){n[d].left=0,n[d].top=0,n[d].angle=0,item_name=void 0!=n[d].name&&"null"!=n[d].name?n[d].name:"item_"+r+d,e("#pdp2_canvas_layer_cv").attr({width:n[d].width*n[d].scaleX,height:n[d].height*n[d].scaleY});var l=new fabric.Canvas("pdp2_canvas_layer_cv",{opacity:1});l.clear();var p=fabric.util.getKlass(n[d].type);if(p.async?p.fromObject(n[d],function(e){l.add(e)}):l.add(p.fromObject(n[d])),e("#pdc_product_config").length>0){var _=JSON.parse(e("#pdc_product_config").val());n[d].text?(""==_.text_price&&(_.text_price=0),void 0==n[d].price&&(n[d].price=_.text_price)):(""==_.clipart_price&&(_.clipart_price=0),void 0==n[d].price&&(n[d].price=_.clipart_price))}else void 0==n[d].price&&(n[d].price=0);a+=parseFloat(n[d].price),s+=parseFloat(n[d].price),("path"==n[d].type||"path-group"==n[d].type||"image"==n[d].type)&&(t='<tr class="pdp2_layer_item" rel="'+item_name+'"><td class="item_type">'+parseInt(d+1)+'</td><td class="item_info"><img src="'+l.toDataURL("png")+'"/></td><td class="item_price">'+c+parseFloat(n[d].price).toFixed(2)+'</td><td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'),"text"==n[d].type&&(t='<tr class="pdp2_layer_item" rel="'+item_name+'"><td class="item_type">'+parseInt(d+1)+'</td><td class="item_info">'+n[d].text.substring(0,15)+'...</td><td class="item_price">'+c+parseFloat(n[d].price).toFixed(2)+'</td><td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'),e(".layer_"+r+" tbody").append(t).parents(".layer_pricing").attr("pr",s)}}),e("#pdp_total_layer_price tfoot tr th:eq(2)").html(c+a.toFixed(2)),e(".item_delete").parent().remove();e("#pdp_side_items li.active").attr("tab")},update_total_price_layer:function(){var t=0;e(".prices_layer").each(function(){var a=e(this).find(".layer_pricing").attr("pr");void 0==a&&(a=0),t+=parseFloat(a)}),e(".item_delete").parent().remove(),e("#pdp_total_layer_price .layer_pricing").attr("pr",t.toFixed(2)),e("#pdp_total_layer_price .layer_pricing th:eq(2)").html(c+t.toFixed(2))},addlayer:function(){var t,a=0,i=JSON.parse(o[e("#pdp_side_items li.active").index()]),n=i.objects,s=e("#pdp_side_items li.active").attr("tab");e(".layer_"+s+" .layer_pricing tbody").html(""),e(".layer_"+s+" tbody").append(t).parents(".layer_pricing").attr("pr",a);for(var r=0;r<n.length;r++){n[r].left=0,n[r].top=0,n[r].angle=0,item_name=void 0!=n[r].name?n[r].name:"item_"+r,e("#pdp2_canvas_layer_cv").attr({width:n[r].width*n[r].scaleX,height:n[r].height*n[r].scaleY});var d=new fabric.Canvas("pdp2_canvas_layer_cv",{opacity:1});d.clear();var l=fabric.util.getKlass(n[r].type);if(l.async?l.fromObject(n[r],function(e){d.add(e)}):d.add(l.fromObject(n[r])),e("#pdc_product_config").length>0){var p=JSON.parse(e("#pdc_product_config").val());n[r].text?(""==p.text_price&&(p.text_price=0),void 0==n[r].price&&(n[r].price=p.text_price)):(""==p.clipart_price&&(p.clipart_price=0),void 0==n[r].price&&(n[r].price=p.clipart_price))}else void 0==n[r].price&&(n[r].price=0);a+=parseFloat(n[r].price),("path"==n[r].type||"path-group"==n[r].type)&&(t='<tr class="pdp2_layer_item" rel="'+item_name+'"><td class="item_type">'+parseInt(r+1)+'</td><td class="item_info"><img src="'+d.toDataURL("png")+'"/></td><td class="item_price">'+c+parseFloat(n[r].price).toFixed(2)+'</td><td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'),"image"==n[r].type&&(t='<tr class="pdp2_layer_item" rel="'+item_name+'"><td class="item_type">'+parseInt(r+1)+'</td><td class="item_info"><img src="'+n[r].isrc+'"/></td><td class="item_price">'+c+parseFloat(n[r].price).toFixed(2)+'</td><td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'),"text"==n[r].type&&(t='<tr class="pdp2_layer_item" rel="'+item_name+'"><td class="item_type">'+parseInt(r+1)+'</td><td class="item_info">'+n[r].text.substring(0,15)+'...</td><td class="item_price">'+c+parseFloat(n[r].price).toFixed(2)+'</td><td><a class="item_delete" title="Remove"><i class="pi pi-trash-o"></i></a></td></tr>'),e(".layer_"+s+" tbody").append(t).parents(".layer_pricing").attr("pr",a)}canvasEvents.update_total_price_layer()},activeobj:function(e){var t=a.getObjects();if(""!=e&&void 0!=e)for(var i=0;i<t.length;i++)t[i].name==e&&a.setActiveObject(t[i])},resetShadowForm:function(){e("#use_shadow").removeClass("active"),e("#h-shadow").val(0),e("#v-shadow").val(0),e("#t-blur").val(0),e("#font_outline_color_value").css({"background-color":"#FFF",color:"#000"}).val("#FFFFFF"),e(".font_outline_color > div:not(.use_shadow)").hide()},addShadowItem:function(){var t=a.getActiveObject();t&&(setting_shadow={h_shadow:e("#h-shadow").val(),v_shadow:e("#v-shadow").val(),blur:e("#t-blur").val(),color:e("#font_outline_color_value").val()},t.setShadow({color:setting_shadow.color,blur:setting_shadow.blur,offsetX:setting_shadow.v_shadow,offsetY:setting_shadow.h_shadow}),canvasEvents.renderall())},renderall:function(){a.selection=!1,canvasEvents.save_history(),canvasEvents.save_design2(),a.calcOffset().renderAll(),canvasEvents.addlayer()},reset_canvas:function(t){var i,n,r=e("#pdp_side_items li[tab="+t+"]"),c=e("#pdp_side_items li[tab="+t+"]").index();r.length>0&&(i=s+"media/pdp/images/"+r.attr("side_img"),e("#main_image").attr("src",i),n=r.attr("inlay").split(","),e("#wrap_inlay").html('<canvas id="canvas_area"></canvas>'),e("#wrap_inlay").css({width:n[0]+"px",height:n[1]+"px",top:n[2]+"px",left:n[3]+"px"}),e("#canvas_area").attr({width:n[0],height:n[1]}),a=new fabric.Canvas("canvas_area",{}),a.clear(),a.observe("object:selected",canvasEvents.objectSelected),a.observe("object:modified",canvasEvents.renderall),a.observe("object:modified",canvasEvents.showinfo),a.observe("object:added",canvasEvents.renderall),a.observe("before:selection:cleared",canvasEvents.objectUnselected),canvasEvents.load_json(o[c]),canvasEvents.centerCanvas(),canvasEvents.renderall())},save_history:function(){var t=e("#pdp_side_items li.active").index();o[t]=JSON.stringify(a.toJSON(["name","price","tcolor","isrc","icolor","id"]))},editShadowItem:function(){var t=a.getActiveObject();if(t){var i=t.get("shadow");null!=i&&"none"!=i.color?(setting_shadow={h_shadow:e("#h-shadow").val(),v_shadow:e("#v-shadow").val(),blur:e("#t-blur").val(),color:e("#font_outline_color_value").val()},t.setShadow({color:setting_shadow.color,blur:setting_shadow.blur,offsetX:setting_shadow.v_shadow,offsetY:setting_shadow.h_shadow})):canvasEvents.resetShadowForm(),a.calcOffset().renderAll()}},changeToEditItem:function(){var t=a.getActiveObject();if(t){var i=t.get("opacity");e("#pdp_opacity_input").val(10*i);var n=t.get("shadow");if(1==t.tcolor)e(".pdp_color_list ul.mCustomScrollbar").show(),e(".pdp_color_list ul").show(),e(".pdp_color_list ul.pdp_color_png").hide(),e(".nomore_color").hide();else{var s=t.isrc.split("/");e(".pdp_color_list ul.mCustomScrollbar").hide(),e(".pdp_color_list ul").hide(),e(".pdp_color_list ul.pdp_color_png").show(),e(".pdp_color_png a.active").removeClass("active"),e('.pdp_color_png a[rel="'+s[s.length-1]+'"]').addClass("active"),e(".pdp_color_png li").hide(),""!=t.icolor&&void 0!=t.icolor&&0==e('.pdp_color_png li[alt="'+t.id+'"]').length&&canvasEvents.makelistcolor(t.icolor,t.id),e('.pdp_color_png li[alt="'+t.id+'"]').show(),0==e("ul.pdp_color_png li:visible").length?e(".nomore_color").show():e(".nomore_color").hide()}null==n||"none"==n.color?canvasEvents.resetShadowForm():(e(".font_outline_color > div:not(.use_shadow)").show(),e("#h-shadow").val(n.offsetY),e("#v-shadow").val(n.offsetX),e("#t-blur").val(n.blur),e("#font_outline_color_value").val(n.color).css("background-color",n.color),e("#use_shadow").addClass("active"))}},change_main_image:function(){var t=e("#pdp_side_items li.active").attr("tab"),a=e(".pdp_design_color li.active").attr(t),i=e("#pdp_media_url").val();e("#main_image").attr("src",i+a)},editText:function(){var t=a.getActiveObject();if(t){var i=t.width;"curvedText"!=t.type&&t.setText(e("#pdp_edit_text_input").val());var n=t.width;e("#edit_item_wrap").show(),e("#edit_text").css("opacity","1"),e("#font_outline_colorpicker").hide();var s,o,r,c=e("#font_color").css("color"),d=e("#select_font li.active").attr("rel"),l=e("#pdp_edit_text_line_height_input").val()/10,p=(t.get("left"),t.get("top"),e("#pdp_font_size_input").val()),_="";if(s=e(".pdp_edit_font_style .bold").hasClass("active")?"bold":"",o=e(".pdp_edit_font_style .italic").hasClass("active")?"italic":"",e(".pdp_edit_font_style .underline").hasClass("active")&&(_+=" underline "),e(".pdp_edit_font_style .overline").hasClass("active")&&(_+=" overline "),e(".pdp_edit_font_style .line-through").hasClass("active")&&(_+=" line-through "),e("#pdp_edit_text_style .align.align_left").hasClass("active")&&(r="left"),e("#pdp_edit_text_style .align.align_right").hasClass("active")&&(r="right"),e("#pdp_edit_text_style .align.align_center").hasClass("active")&&(r="center"),t.set({fill:c,fontSize:p,fontStyle:o,fontWeight:s,textDecoration:_,fontFamily:d,lineHeight:l,textAlign:r}),"right"==r)if(n>i){var v=parseFloat(t.left)-n+i;t.set({left:v})}else{var v=parseFloat(t.left)+i-n;t.set({left:v})}else if("center"==r)if(n>i){var v=parseFloat(t.left)-(n-i)/2;t.set({left:v})}else{var v=parseFloat(t.left)+(i-n)/2;t.set({left:v})}e("#use_shadow").hasClass("active")?(setting_shadow={h_shadow:e("#h-shadow").val(),v_shadow:e("#v-shadow").val(),blur:e("#t-blur").val(),color:e("#font_outline_color_value").val()},t.setShadow({color:setting_shadow.color,blur:setting_shadow.blur,offsetX:setting_shadow.v_shadow,offsetY:setting_shadow.h_shadow})):(canvasEvents.resetShadowForm(),t.setShadow("none")),canvasEvents.renderall()}},addText:function(t){e("#add_text").slideUp(300),e("#add_text_input").val(""),e("#edit_text").css("opacity","1"),e("#color_item").css("opacity",.5);var i=e("#font_color").css("color"),n="Arial",s=parseInt(e("#pdp_info_item").attr("critem"));i="#111",e("#pdp_info_item").attr("critem",s+1);var o={};o.text_price=0,e("#pdc_product_config").length&&(o=JSON.parse(e("#pdc_product_config").val()));var r=a.getCenter(),c=new fabric.Text(t,{fontFamily:n,left:r.left,top:r.top,fontSize:20,textAlign:"left",fill:i,price:o.text_price,name:"item_"+s,lineHeight:"1.3",fontStyle:"",fontWeight:"normal",textDecoration:"",shadow:"",padding:setting.padding});c.lockUniScaling=!1,c.hasRotatingPoint=!0,c.transparentCorners=!0,c.cornerColor=setting.border,a.add(c).setActiveObject(c),canvasEvents.center(),canvasEvents.addlayer(),e("#use_shadow").click(),canvasEvents.renderall()},addTextCurved:function(t){e("#add_text").slideUp(300),e("#add_text_input").val(""),e("#edit_text").css("opacity","1"),e("#color_item").css("opacity",.5);var i="#111",n="Arial",s=a.getCenter(),o=new fabric.CurvedText(t,{left:s.left,top:s.top,fontFamily:n,textAlign:"left",fill:i,radius:100,perPixelTargetFind:!0,fontSize:20,spacing:15,lockUniScaling:!0});o.lockUniScaling=!0,o.hasRotatingPoint=!0,o.transparentCorners=!0,o.cornerColor=setting.border,a.add(o).setActiveObject(o),canvasEvents.center(),canvasEvents.renderall()},editCurvedText:function(){canvasEvents.renderall()},changeToEditText:function(a){if(e("#tab_text").prop("checked",!0),e('a[tab="pdp_edit_text_curved"]').hide(),!a)return!1;e("#pdp_edit_text_input").val(a.getText());var i=a.get("fontFamily"),n=a.get("fontSize"),s=a.get("textDecoration"),o=a.get("fontStyle"),r=a.get("textAlign"),c=a.get("fontWeight"),d=a.get("fill"),l=a.get("opacity"),p=a.get("lineHeight"),_=a.get("shadow");e("#font_color").css("color",d),e("#font_color_colorpicker_value").css("background-color",d).val(t(d)),_&&""!=_&&"none"!=_.color?(e(".font_outline_color > div").show(),e("#use_shadow").addClass("active"),e("#h-shadow").val(_.offsetY),e("#v-shadow").val(_.offsetX),e("#t-blur").val(_.blur),e("#font_outline_color_value").val(_.color).css("background-color",_.color)):canvasEvents.resetShadowForm(),e("#pdp_opacity_input").val(10*l),e(".pdp_edit_text_tab_content").hide(),"curvedText"==a.get("type")?(e("#pdp2_curved_text").val(a.getText()),e("#pdp_edit_text_tab a.active").removeClass("active"),e("#pdp_edit_text_tab_content, a[tab=pdp_edit_text_tab_content]").hide(),e(".pdp_curved_text_control").show(),e('a[tab="pdp_edit_text_curved"], #pdp_edit_text_curved').addClass("active").show()):(e('a[tab="pdp_edit_text_tab_content"]').addClass("active").show(),e('#pdp_edit_text_tab a[tab!="pdp_edit_text_curved"], #pdp_edit_text_tab_content').show()),e(".pdp_edit_font_style a, #pdp_edit_text_style a").removeClass("active"),e("#pdp_font_size_value").html(n+"px"),e("#pdp_font_line_height_value").html(p),"right"==r?e("#pdp_edit_text_style .align_right").addClass("active"):"center"==r?e("#pdp_edit_text_style .align_center").addClass("active"):e("#pdp_edit_text_style .align_left").addClass("active"),"bold"==c&&e(".pdp_edit_font_style .bold").addClass("active"),"italic"==o&&e(".pdp_edit_font_style .italic").addClass("active"),s.indexOf("underline")>0&&e(".pdp_edit_font_style .underline").addClass("active"),s.indexOf("overline")>0&&e(".pdp_edit_font_style .overline").addClass("active"),s.indexOf("line-through")>0&&e(".pdp_edit_font_style .line-through").addClass("active"),e("#pdp_color").css("color","#111"),"#111"==d?e("#pdp_color_text li:eq(0) a").addClass("active"):e("#pdp_color_text li a").each(function(){}),e("#pdp_color_text_input").css("background-color",d),e("#select_font li").removeClass("active"),e('#select_font li[rel="'+i+'"]').addClass("active"),e("#pdp_edit_text_line_height_input").val(10*p),e("#pdp_font_line_height_value").html(parseInt(10*p)+"px"),e("#pdp_font_size_input").val(n),"curvedText"==a.type?(e("#use_curved").addClass("active"),e(".pdp_curved_text_control").show()):(e("#use_curved").removeClass("active"),e(".pdp_curved_text_control").hide())},addSvg:function(t,i,n,s,o,r){fabric.loadSVGFromURL(t,function(c,d){var l=fabric.util.groupSVGElements(c,d),p=(a.getCenter(),parseInt(e("#pdp_info_item").attr("critem")));e("#pdp_info_item").attr("critem",p+1),(""==i||void 0==i)&&(i=0),(""==n||void 0==n)&&(n="not_add"),l.set({perPixelTargetFind:!0,isrc:t,price:i,tcolor:s,icolor:o,name:n,id:r,fill:setting.color,transparentCorners:!0,padding:setting.padding}),l.width>a.width&&l.scaleToWidth(a.width-20),l.setCoords(),a.centerObject(l),l.hasRotatingPoint=!0,l.lockUniScaling=!0,a.add(l).setActiveObject(l),canvasEvents.addlayer()})},resetTextForm:function(){e("#pdp_font_size_input").val(20),e("#pdp_font_size_value").html("20px"),e("#pdp_edit_text_line_height_input").val(13),e("#pdp_font_line_height_value").html("13px"),e("#use_shadow").attr("checked",!1),e("#add_text_action").show(),e("#edit_text_action, .pdp_edit_text_tab_content").hide(),e("#edit_text").css("opacity",.5),e("#add_text_input").val(""),e("#select_font_span").html("Arial").css("font-family","Arial"),e("#pdp_edit_text_tab_content").show(),e("#pdp_color_text input").val("#111111"),e("#font_outline_colorpicker").setColor("#FFFFFF"),e("#pdp_edit_text .active, #pdp_edit_text_style .active").removeClass("active"),e("#pdp_edit_text_tab a:eq(0),#pdp_edit_text_style .align_left").addClass("active"),e("#select_font li").removeClass("active"),e("#select_font li:eq(0)").addClass("active"),e("#use_curved").removeClass("active"),e(".pdp_curved_text_control").hide()},objectUnselected:function(){e("#pdp_info_item li.active").removeClass("active"),e(".pdp_extra_item, .tab_content:not(#pdp_rotate_item), #font_outline_colorpicker").slideUp(400),e("#edit_item_wrap .active").removeClass("active"),e("#edit_item_wrap").removeClass("active"),e("#edit_item_wrap div.item").css("opacity",.5)},clearSelected:function(){this.objectUnselected(),a.deactivateAll().renderAll()},centerX:function(){var e=a.getActiveObject();e&&(a.centerObjectH(e),e.setCoords(),canvasEvents.renderall())},center:function(){var e=a.getActiveObject();e&&(a.centerObjectH(e),a.centerObjectV(e),e.setCoords(),canvasEvents.renderall())},centerY:function(){var e=a.getActiveObject();e&&(a.centerObjectV(e),e.setCoords(),canvasEvents.renderall())},rotateRight:function(e){var t=e.getActiveObject();if(t){var a=t.get("angle");t.rotate(a+45),t.setCoords(),canvasEvents.renderall()}},rotateLeft:function(e){var t=e.getActiveObject();if(t){var a=t.get("angle");t.rotate(a-45),t.setCoords(),canvasEvents.renderall()}},flipX:function(){var e=a.getActiveObject();e&&(e.flipX=e.flipX?!1:!0,e.setCoords(),canvasEvents.renderall())},flipY:function(){var e=a.getActiveObject();e&&(e.flipY=e.flipY?!1:!0,e.setCoords(),canvasEvents.renderall())},load_json:function(t){var i=JSON.parse(t),n=i.objects;a.clear(),e("#pdp_info_item").attr("critem",n.length);var s=!1;if(n.forEach(function(e){return"text"==e.type?void(s=!0):void 0}),!e(".pdp_side_item_content.active.first-loaded").length&&s){var o=new fabric.Text("Loading...",{left:0,top:0,fontSize:25,shadow:"rgba(0,0,0,0.3) 5px 5px 5px",fontFamily:"Impact",stroke:"#fff",strokeWidth:1});setTimeout(function(){a.remove(o),canvasEvents.renderall(),e(".pdp_side_item_content.active").addClass("first-loaded")},r)}fabric.util.enlivenObjects(n,function(e){var t=a.renderOnAddRemove;a.renderOnAddRemove=!1,e.forEach(function(e){a.add(e)}),a.renderOnAddRemove=t,a.renderAll()})},copyObject:function(){var e=a.getActiveObject();e&&(fabric.util.getKlass(e.type).async?e.clone(function(t){t.set({isrc:e.isrc,price:e.price,transparentCorners:!0,cornerColor:setting.border}),a.add(t)}):a.add(e.clone().set({transparentCorners:!0,cornerColor:setting.border})),canvasEvents.addlayer(),canvasEvents.renderall())},removeObject:function(){var t=a.getActiveObject();t&&(e('#pdp_info_item li[rel="'+t.name+'"]').remove(),a.remove(t),canvasEvents.renderall())},moveObject:function(e){var t=a.getActiveObject();t&&("up"==e?(t.setTop(t.getTop()-1).setCoords(),canvasEvents.renderall()):"down"==e?(t.setTop(t.getTop()+1).setCoords(),canvasEvents.renderall()):"left"==e?(t.setLeft(t.getLeft()-1).setCoords(),canvasEvents.renderall()):"right"==e&&(t.setLeft(t.getLeft()+1).setCoords(),canvasEvents.renderall()))},applyFilter:function(e,t){var i=a.getActiveObject();i.filters[e]=t,i.applyFilters(a.renderAll.bind(a))},changeTextColor:function(e){var t=a.getActiveObject();t&&("text"==t.type||"path"==t.type)&&("transparent"==e?t.set("fill","#FFF"):t.set("fill",e),a.renderAll())},changeColor:function(e){var t=a.getActiveObject();t&&("text"==t.type||"path"==t.type?"transparent"==e?t.set("fill","#FFF"):t.set("fill",e):"transparent"==e?t.set("fill","#111"):t.set("fill",e),canvasEvents.renderall())},save_png:function(t,a,i){if(fabric.Canvas.supports("toDataURL")){canvasEvents.clearSelected();var n=a.split(",");e("#pdp_result_2").html('<canvas id="canvas_export_2"></canvas>'),e("#canvas_export_2").attr({width:n[0],height:n[1]});for(var s=new fabric.Canvas("canvas_export_2",{opacity:1}),r=JSON.parse(o[i]),c=r.objects,d=0;d<c.length;d++){var l=fabric.util.getKlass(c[d].type);l.async?l.fromObject(c[d],function(e){s.add(e)}):s.add(l.fromObject(c[d]))}s.renderAll(),e("#pdp_canvas_result").html('<canvas id="canvas_export"></canvas>'),e("#canvas_export").attr({width:n[4],height:n[5]});var p=new fabric.Canvas("canvas_export",{opacity:1});p.setBackgroundImage(t,p.renderAll.bind(p)),fabric.Image.fromURL(s.toDataURL("png"),function(e){e.set({left:parseFloat(n[3]),top:parseFloat(n[2]),width:n[0],height:n[1],angle:0,selectable:!1}),e.transparentCorners=!0,e.cornerSize=10,e.scale(1).setCoords(),p.add(e)}),p.renderAll(),e("#pdp_canvas_result").animate({opacity:1},600,function(){e("#pdp_side_items li:eq("+i+")").children("img").attr("src",p.toDataURL("png"))})}else alert("This browser doesn't provide means to serialize canvas to an image")},isRenderFinished:function(){return e("#pdp_side_items li.rendered").length==e("#pdp_side_items li").length?(clearTimeout(n),void canvasEvents.actionAfterRendered()):void(n=setTimeout(canvasEvents.isRenderFinished,r))},resetBeforeRender:function(){e("#pdp_side_items li").removeClass("rendered")},actionAfterRendered:function(){var t=e("#temp_action").val();switch(t){case"SAVE_ADMIN_TEMPLATE":canvasEvents.saveJsonFileAndImage();break;case"PREVIEW":e("#pdp2_zoom_content").remove(),e("#pdp_design_popup").append('<div id="pdp2_zoom_content"><span class="inlay"></span><div id="pdp2_zoom_img"><img src="'+e("#pdp_side_items li.active img").attr("src")+'" /><span class="close"></span></div></div>'),e("body").on("click","#pdp2_zoom_content .close",function(){e("#pdp2_zoom_content").hide()}),e("#pdp2_zoom_img img").attr("src",e("#pdp_side_items li.active img").attr("src")),e("#pdp2_zoom_content").show(),e(".pdploading").hide();break;case"SHARE":canvasEvents.saveJsonBeforeShare();break;case"DOWNLOAD":e("#pdp2_zoom_content").remove(),e("#pdp_design_popup").append('<div id="pdp2_zoom_content"><span class="inlay"></span><div id="pdp2_zoom_img"><img src="'+e("#pdp_side_items li.active img").attr("src")+'" /><a id="export_image" href="">Press this button to download and close</a></div></div>'),e("#pdp2_zoom_img img").attr("src",e("#pdp_side_items li.active img").attr("src")),e("#pdp2_zoom_content").show(),e("#export_image").attr("href",e("#pdp_side_items .active img").attr("src"));var a="Customize-product-"+e("#current_product_id").val()+"-"+e("#pdp_side_items .active").attr("id")+".png";e("#export_image").attr("download",a),e("#is_backend").length&&(e("#pdp2_zoom_content_backend").remove(),e("body").append("<div id='pdp2_zoom_content_backend'></div>"),e("#pdp2_zoom_content_backend").html(e("#pdp2_zoom_content").parent().html())),e("body").on("click","#export_image",function(){e("#pdp2_zoom_content").hide(),e("#pdp2_zoom_content_backend").html("")}),e(".pdploading").hide();break;default:console.log("Current Action"+t,"Do nothing")}},save_design2:function(t){if(t!==!0)return!1;if(fabric.Canvas.supports("toDataURL")){canvasEvents.resetBeforeRender(),d={};var a;e("#pdp_side_items li").each(function(t){a=JSON.parse(o[t]);var i=document.getElementById("thumbnail_"+this.id.replace("side_",""));d[this.id]={temp_canvas:null,final_canvas:null,json:a,background:s+"media/pdp/images/"+e(this).attr("side_img"),inlay_info:e(this).attr("inlay").split(","),final_canvas_width:i.naturalWidth,final_canvas_height:i.naturalHeight},canvasEvents.renderSide(e(this),this.id,r)}),n=setTimeout(canvasEvents.isRenderFinished,r)}else alert("This browser doesn't provide means to serialize canvas to an image")},renderSide:function(t,a){e(".pdploading").show(),e("#temp_canvas_"+a).remove(),e("#final_canvas_"+a).remove(),e("#pdp_canvas_result").append('<canvas id="temp_canvas_'+a+'"></canvas><canvas id="final_canvas_'+a+'"></canvas>'),e("#final_canvas_"+a).attr({width:d[a].final_canvas_width,height:d[a].final_canvas_height}),e("#temp_canvas_"+a).attr({width:d[a].inlay_info[0],height:d[a].inlay_info[1]}),d[a].final_canvas=new fabric.Canvas("final_canvas_"+a,{opacity:1}),d[a].temp_canvas=new fabric.Canvas("temp_canvas_"+a,{opacity:1}),d[a].final_canvas.setBackgroundImage(d[a].background,d[a].final_canvas.renderAll.bind(d[a].final_canvas));var i=d[a].json.objects;fabric.util.enlivenObjects(i,function(e){var t=d[a].temp_canvas.renderOnAddRemove;d[a].temp_canvas.renderOnAddRemove=!1,d[a].temp_canvas.stateful=!1,e.forEach(function(e){d[a].temp_canvas.add(e)}),d[a].temp_canvas.renderOnAddRemove=t}),d[a].temp_canvas.renderAll(),setTimeout(function(){fabric.Image.fromURL(d[a].temp_canvas.toDataURL("png"),function(e){e.set({left:parseFloat(d[a].inlay_info[3]),top:parseFloat(d[a].inlay_info[2]),width:d[a].inlay_info[0],height:d[a].inlay_info[1],angle:0,selectable:!1}),e.transparentCorners=!0,e.cornerSize=10,e.scale(1).setCoords(),d[a].final_canvas.renderOnAddRemove=!1,d[a].final_canvas.stateful=!1,d[a].final_canvas.add(e),d[a].final_canvas.renderAll(),t.children("img").attr("src",d[a].final_canvas.toDataURL("png")),t.addClass("rendered")})},r)},saveJsonFileAndImage:function(){canvasEvents.clearSelected();var t=(e("#skin_url").val(),e("#base_dir").val());mitem=parseInt(e("#pdp_side_items li").length),dt={items:[]};var a=new Array;e("#pdp_side_items li").each(function(){var i=e(this).index(),n=e(this).children("img").attr("src"),o=n.split(":");if("data"==o[0]){var r={base_dir:t,data:n,index:i},c=s+"js/pdp/saveanimage.php",d=PDPAction.deferredRequest(c,r,function(t){var a=JSON.parse(t);e("#pdp_side_items li:eq("+a.index+")").children("img").attr("src",a.path)});a.push(d)}}),e.when.apply(null,a).done(function(){e("#pdp_side_items li").each(function(){item={side_name:e(this).attr("label"),side_img:e(this).attr("side_img"),json:o[e(this).index()],image_result:e(this).find("img").attr("src"),final_price:e("#pdp_total_layer_price .layer_pricing").attr("pr")},dt.items.push(item)});var t=s+"index.php/pdp/index/saveJsonfile",a=JSON.stringify(dt);if(""!=a){var i=!0;try{{JSON.parse(a)}}catch(n){i=!1}if(i){var r=!1;e("#is_backend").length&&(r=!0);var c=PDPAction.deferredRequest(t,{json_file:a},function(t){var a=e.parseJSON(t);e("input[name='extra_options']").val(a.filename),e("input[name='extra_options']",top.document).val(a.filename)});e.when(c).done(function(){if(e(".pdploading").hide(),r){var t=e("#url_site").val()+"pdp/index/saveAdminTemplate",a=e("#current_product_id").val(),i={product_id:a,pdp_design:e("input[name='extra_options']").val()};PDPAction.doRequest(t,i,function(){void 0!==window.top.Windows?window.top.Windows.closeAll():e(".pdploading").hide()})}else if(e("#pdc_iframe",l).css({top:"-100000px"}),e(".catalog-product-view",l).css({overflow:"inherit"}),e(".product-img-box img",l).attr("src",e("#pdp_side_items li:eq(0)").children("img").attr("src")).css({width:"100%"}),e(".product-img-box",l).append('<span class="loadinggif"></span>'),e(".product-img-box img",l).load(function(){e(".product-img-box .loadinggif",l).remove()}),mitem>1&&(e(".more-views",l).remove(),0==e(".product-img-box .pdp_more_view",l).length?e(".product-img-box",l).append('<div class="more-views"><h2>More Views</h2><ul class="pdp_more_view"></ul></div>'):e(".pdp_more_view",l).html("")),e("#pdp_side_items li").each(function(){e(".pdp_more_view",l).append('<li style="padding: 0px 3px;"><img class="pdp-thumb" width="56" height="56" src="'+e(this).find("img").attr("src")+'" /></li>')}),e(".pdp_more_view li img",l).click(function(){e(".product-img-box img",l).attr("src",e(this).attr("src")).css({width:"100%"}),void 0!==top.window.ProductMediaManager&&top.window.ProductMediaManager.init()}),void 0!==top.window.ProductMediaManager&&top.window.ProductMediaManager.init(),e("#product_price_config",l).length){var n=JSON.parse(e("#product_price_config",l).val());if(void 0===n.productId)return!1;var s=parseFloat(e("#pdp_total_layer_price .layer_pricing").attr("pr"));n.productPrice=n.productPrice+s,n.productOldPrice=n.productOldPrice+s,parent.optionsPrice=new parent.Product.OptionsPrice(n);try{parent.optionsPrice.reload()}catch(o){console.log(o)}}})}}})},saveJsonBeforeShare:function(){canvasEvents.clearSelected();
var t=(e("#skin_url").val(),e("#base_dir").val());mitem=parseInt(e("#pdp_side_items li").length),price=e("#pdp_total_layer_price .layer_pricing").attr("pr"),dt={items:[]};var a=new Array;e("#pdp_side_items li").each(function(){var i=e(this).index(),n=e(this).children("img").attr("src"),o=n.split(":");if("data"==o[0]){var r={base_dir:t,data:n,index:i},c=s+"js/pdp/saveanimage.php",d=PDPAction.deferredRequest(c,r,function(t){var a=JSON.parse(t);e("#pdp_side_items li:eq("+a.index+")").children("img").attr("src",a.path)});a.push(d)}}),e.when.apply(null,a).done(function(){e("#pdp_side_items li").each(function(){item={side_name:e(this).attr("label"),side_img:e(this).attr("side_img"),json:o[e(this).index()],image_result:e(this).find("img").attr("src")},dt.items.push(item)});var t=s+"index.php/pdp/index/saveJsonfile",a=JSON.stringify(dt);if(""!=a){var i=!0;try{{JSON.parse(a)}}catch(n){i=!1}if(i){var r=PDPAction.deferredRequest(t,{json_file:a},function(t){var a=e.parseJSON(t);e("input[name='share_json']").val(a.filename)});e.when(r).done(function(){e(".pdploading").hide();var t=e("#save_design_url").val(),a=e("#current_product_id").val(),i={product_id:a,pdpdesign:e("input[name='share_json']").val(),url:e("#product_url").val()};PDPAction.doRequest(t,i,function(t){var a=e.parseJSON(t),i=e.parseJSON(a.final_images);e(".pinterest-share-thumbnail").html(""),i.length&&e.each(i,function(t,a){console.log(a);var i='<img src="'+a.image+'"/>';e(".pinterest-share-thumbnail").append(i)});for(var n=0;n<addthis.links.length;n++)addthis.links[n].share.url=a.url;e(".pdploading").hide(),e(".pdp_share_buttons").animate({height:"55px"},"fast"),setTimeout(function(){e(".pdp_share_buttons").css({opacity:"1"})},700),e(".pdp_share_buttons").slideToggle("fast")})})}}})},save_design:function(t,i,n){e("#save_design").addClass("loading");if(fabric.Canvas.supports("toDataURL")){var o=s+"media/pdp/images/"+e("#pdp_side_items li:eq("+t+")").attr("side_img"),r=e("#pdp_side_items li:eq("+t+")").attr("inlay");canvasEvents.clearSelected();var c=r.split(",");e("#pdp_canvas_result").html('<canvas id="canvas_export"></canvas>'),e("#canvas_export").attr({width:i,height:n});var d=new fabric.Canvas("canvas_export",{opacity:1});d.setBackgroundImage(o,d.renderAll.bind(d)),fabric.Image.fromURL(a.toDataURL("png"),function(e){e.set({left:parseFloat(c[3]),top:parseFloat(c[2]),width:c[0],height:c[1],angle:0,selectable:!1}),e.transparentCorners=!0,e.cornerSize=10,e.scale(1).setCoords(),d.add(e)}),d.renderAll(),e("#pdp_result").animate({opacity:1},600,function(){e("#save_design").removeClass("loading"),e("#pdp_side_items li:eq("+t+")").children("img").attr("src",d.toDataURL("png")),e("#pdp_result").html("")})}else alert("This browser doesn't provide means to serialize canvas to an image")},save_design_json:function(){var t={title:e(".product-title").html(),sides:[]};return e("#pdp_side_items li").each(function(){var a={label:e(this).attr("label"),inlay:e(this).attr("inlay"),img:e(this).attr("side_img"),thumnail:e(this).children("img").attr("src"),canvas:o[e(this).index()]};t.sides.push(a)}),JSON.stringify(t)},saveSampleDesign:function(){e("#save_sample_design").click(function(){var t=canvasEvents.save_design_json();e.ajax({type:"POST",url:e("#url_site").val()+"index.php/pdp/view/saveSampleDesign",data:{json_string:t},beforeSend:function(){},error:function(){console.log("Something went wrong...!")},success:function(t){var a=e.parseJSON(t);a.success&&alert(a.message),a.error&&alert(a.message)}})})},centerCanvas:function(){var t=e(".wrapper_pdp").width(),a=e(".wrap_inlay_center").width();e(".wrap_inlay_center").css("margin-left",(t-a)/2+"px")},downloadSideImage:function(){e("#download_image").click(function(){canvasEvents.renderall();var t=(e("#temp_action").val("DOWNLOAD"),e("#pdp_side_items li.active")),a=JSON.parse(o[t.index()]),i=document.getElementById("thumbnail_"+t.attr("id").replace("side_",""));d[t.attr("id")]={temp_canvas:null,final_canvas:null,json:a,background:s+"media/pdp/images/"+t.attr("side_img"),inlay_info:e(t).attr("inlay").split(","),final_canvas_width:i.naturalWidth,final_canvas_height:i.naturalHeight},canvasEvents.resetBeforeRender(),e("#pdp_side_items li").not(".active").addClass("rendered"),canvasEvents.renderSide(t,t.attr("id"),r),n=setTimeout(canvasEvents.isRenderFinished,r)})}()},e("#pdp2_zoom").click(function(){canvasEvents.renderall();var t=(e("#temp_action").val("PREVIEW"),e("#pdp_side_items li.active")),a=JSON.parse(o[t.index()]),i=document.getElementById("thumbnail_"+t.attr("id").replace("side_",""));d[t.attr("id")]={temp_canvas:null,final_canvas:null,json:a,background:s+"media/pdp/images/"+t.attr("side_img"),inlay_info:e(t).attr("inlay").split(","),final_canvas_width:i.naturalWidth,final_canvas_height:i.naturalHeight},canvasEvents.resetBeforeRender(),e("#pdp_side_items li").not(".active").addClass("rendered"),canvasEvents.renderSide(t,t.attr("id"),r),n=setTimeout(canvasEvents.isRenderFinished,r)}),e('#font_color_list li a[rel="000000"]').addClass("active"),e(".pdp_design_color").prepend('<li id="pdp_color_ori" name="pdp_color_ori" class="active"></li>'),e(".pdp_design_color li").click(function(){e(".pdp_design_color li.active").removeClass("active"),e(this).addClass("active"),e("#pdp_side_items li").each(function(){var t=e(this).attr("tab"),a=e(".pdp_design_color li.active").attr(t);e(this).attr("side_img",a).children("img").attr("src",s+"media/pdp/images/"+a)}),PDPsetting.change_image()}),e("#prices_layer tbody").on("click","tr",function(){e(this).hasClass("active")||(e(".prices_layer tbody tr.active").removeClass("active"),e(this).addClass("active")),canvasEvents.activeobj(e(this).attr("rel"))});var _=e("#pdp_side_items li").length;1==_&&e("#pdp_rotate_item, #rotate-180").hide(),e("#save_design").click(function(){e("#temp_action").val("SAVE_ADMIN_TEMPLATE"),canvasEvents.renderall(),canvasEvents.save_design2(!0)}),e("body").on("click","#pdp_share",function(){e("#temp_action").val("SHARE"),canvasEvents.save_design2(!0)}),setting={color:"#000",border:"#88AFFB",padding:5,cornerSize:8,center_canvas:function(){var t=e(".wrap_pdp_design").width();e(".product-image").each(function(){e(".product-image").hide(),e(this).show();var a=e(this).find(".wrap_inlay_center img").width();e(this).find(".wrap_inlay_center").css({"margin-left":(t-a)/2+"px","float":"left"})}),e(".product-image:not(.act)").hide(),e(".product-image.act").show(),canvasEvents.renderall()},first_category:function(){var t=e("#image_category_list li:eq(0) span").text();e(".pdp_selected_category").html(t)},active_slider:function(){e("#h-shadow").noUiSlider({range:[-50,50],start:[0],handles:1,slide:function(){canvasEvents.editShadowItem()}}),e("#v-shadow").noUiSlider({range:[-50,50],start:[0],handles:1,slide:function(){canvasEvents.editShadowItem()}}),e("#t-blur").noUiSlider({range:[0,50],start:[0],handles:1,slide:function(){canvasEvents.editShadowItem()}}),e("#pdp_opacity_input").noUiSlider({range:[0,10],start:[10],handles:1,slide:function(){var t=e(this).val()/10,i=a.getActiveObject();i&&(i.set("opacity",t),"curvedText"==i.type&&i.setOpacity(i.text,t),a.calcOffset().renderAll())},serialization:{}}),e("#pdp_opacity_input,#v-shadow,#t-blur,#h-shadow").change(function(){canvasEvents.renderall()}),e("#pdp_font_size_input").noUiSlider({range:[1,200],start:[20],handles:1,slide:function(){e("#pdp_font_size_value").html(parseInt(e(this).val())+"px")}}),e("#pdp_font_size_input").change(function(){canvasEvents.editText()}),e("#font_color").hide().click(function(){e("#font_color_colorpicker").toggle()}),e("#font_color_colorpicker_value").click(function(){e("#font_color_colorpicker").toggle()}),e("#font_color_colorpicker_value").keyup(function(){var t=e(this).val();e(this).css("background-color",t),canvasEvents.changeTextColor(t)}),e("#pdp_edit_text_line_height_input").noUiSlider({range:[1,100],start:[13],handles:1,slide:function(){canvasEvents.editText(),e("#pdp_font_line_height_value").html(parseInt(e(this).val())+"px")}}),e("#font_outline_colorpicker").farbtastic(function(t){e("#font_outline_color_value").css("background-color",t),canvasEvents.editShadowItem(),e("#font_outline_color_value").val(t)}),e("#font_color_colorpicker").farbtastic(function(t){e("#font_color").css("color",t),canvasEvents.changeTextColor(t),e("#font_color_colorpicker_value").val(t).css("background-color",t)})}},setting.first_category(),setting.active_slider(),e(".size_qty, #select_font_size, #h-shadow, #v-shadow, #t-blur").ForceNumericOnly();var v;v=e(e("#pdp_side_items li.active").length>0?"#pdp_side_items li.active":"#pdp_side_items li:eq(0)"),e("#select_font li").each(function(){e(this).css("font-family",e(this).attr("rel"))}),e("#select_font li").click(function(){e("#select_font li.active").removeClass("active"),e(this).addClass("active"),canvasEvents.editText()}),PDPsetting.center_design_area(),v.addClass("active");var h=v.attr("inlay").split(",");e("#wrap_inlay").css({width:h[0]+"px",height:h[1]+"px",top:h[2]+"px",left:h[3]+"px"}),e("#canvas_area").attr({width:h[0],height:h[1]}),a=new fabric.Canvas("canvas_area",{}),e("#pdp_side_items li").each(function(){e(".wrapper_pdp").append(e(this).children("img").clone().addClass("pdp_img_session_"+e(this).index()).removeAttr("width").hide()),e("#pdp_color_ori").attr(e(this).attr("tab"),e(this).attr("side_img")),o[e(this).index()]=JSON.stringify(a.toJSON(["name","price","tcolor","isrc","icolor","id"]))});var g="";if(e("input[name=pdp_design_string]").length&&""!=e("input[name=pdp_design_string]").val()&&(g=JSON.parse(e("input[name=pdp_design_string]").val())),e("#cart_item_id").length&&(""!=e("#cart_item_id").val()||""!=e("#wishlist_item_id").val())&&e("#extra_options_value").val()&&(g=JSON.parse(e("#extra_options_value").val())),""!=g&&void 0!=g)for(e(".pdp_design_color li.active").removeClass("active"),e(".pdp_design_color li["+e("#pdp_side_items li:eq(0)").attr("tab")+'="'+g.items[0].side_img+'"]').addClass("active"),i=0;i<g.items.length;i++)o[i]=g.items[i].json;e("#main_image").addClass("loaded"),e("#main_image").load(function(){e("#main_image").hasClass("loaded")&&(canvasEvents.load_json(o[0]),e("#wrap_inlay").attr("tab",e("#pdp_side_items li:eq(0)").attr("tab")),e("#main_image").removeClass("loaded"),e(".pdp_design_color li.active").click(),canvasEvents.addlayer_first_time())}),e("#edit_item_wrap .item").click(function(){if(e("#edit_item_wrap .item.active").removeClass("active"),1==e(this).css("opacity")){e(this).toggleClass("active");var t=e(this).attr("tab");e(".pdp_extra_item:not(#"+t+")").slideUp(500),e("#"+t).slideToggle(500)}else e(".pdp_extra_item").slideUp(500)}),e("#pdp2_curved_text_reverse").click(function(){var t=a.getActiveObject();t&&(t.set("reverse",e(this).is(":checked")),canvasEvents.renderall())}),e("#pdp2_curved_text_radius").noUiSlider({range:[1,200],start:[100],handles:1,slide:function(){e("#pdp2_curved_text_radius_value").val(e(this).val())}}),e("#pdp2_curved_text_done").click(function(){var t=e("#pdp2_curved_text").val(),i=a.getActiveObject();i&&(i.setText(t),canvasEvents.editText(),canvasEvents.renderall())}),e("#pdp2_curved_text_radius_value").ForceNumericOnly(),e("#pdp2_curved_text_radius_value").change(function(){e("#pdp2_curved_text_radius").val(e(this).val()),canvasEvents.editText()}),e("#pdp2_curved_text_spacing").noUiSlider({range:[1,50],start:[15],handles:1,slide:function(){e("#pdp2_curved_text_spacing_value").val(e(this).val())}}),e("#pdp2_curved_text_spacing_value").ForceNumericOnly(),e("#pdp2_curved_text_spacing_value").change(function(){e("#pdp2_curved_text_spacing").val(e(this).val()),canvasEvents.editText()}),e("#pdp2_curved_text_radius, #pdp2_curved_text_spacing").change(function(){var t=a.getActiveObject();t&&("pdp2_curved_text_radius"==e(this).attr("id")&&t.set("radius",e(this).val()),"pdp2_curved_text_spacing"==e(this).attr("id")&&t.set("spacing",e(this).val()),canvasEvents.renderall())}),e("#icon_list, #lists_img_upload, #photos_album").on("click","img",function(){var t=e(this).attr("src"),i=t.split("."),n=(e(this).width(),t.split("/")),s=e(this).attr("image_name"),o=e(this).attr("id"),r=e(this).attr("color_type"),c=e(this).attr("color");himg=e(this).height(),e(this).hasClass("added_color")||(e(this).addClass("added_color"),2==r&&canvasEvents.makelistcolor(c,o));var d=e(this).attr("price");if(void 0==d){var l={};l.clipart_price=0,e("#pdc_product_config").length&&(l=JSON.parse(e("#pdc_product_config").val())),d=l.clipart_price}e("#design_control .tab_content:not(#pdp_rotate_item)").slideUp(200),"svg"!=i[i.length-1]?fabric.Image.fromURL(t,function(e){var i=p(a.width,a.height,e.width,e.height);e.set({angle:0,price:d,id:o,isrc:t,tcolor:r,icolor:n[n.length-1],width:i.width,height:i.height,padding:setting.padding}),e.transparentCorners=!0,e.cornerSize=10,e.scale(1).setCoords(),a.centerObject(e),a.add(e).setActiveObject(e),canvasEvents.addlayer()}):canvasEvents.addSvg(t,e(this).attr("price"),s,r,c,o)}),e("#edit_item_wrap").owlCarousel({items:10,itemsDesktop:[1e3,7],itemsDesktopSmall:[900,4],itemsTablet:[600,2],itemsMobile:[340,1],lazyLoad:!0,navigation:!0,navigationText:["&#xf053;","&#xf054;"]}),e(".add_artwork > a").on("click",function(){e(".tab_content:not(#select_image, #pdp_rotate_item)").slideUp(0),e("#select_image").slideToggle(0)}),e(".add_text > a").on("click",function(){e("#add_text").slideToggle(0),e("#font_outline_colorpicker").hide(),e(".tab_content:not(#add_text, #pdp_rotate_item), .pdp_extra_item").slideUp(0),e(".pdp_text_list li.active").removeClass("active")}),e(".pdp_close").click(function(){e(this).parents(".tab_content").slideUp(0)}),e(".pdp_text_list ul li").click(function(){e(".pdp_text_list ul li.active").removeClass("active"),e("#add_text_input").val(e(this).text()),e(this).addClass("active")}),e(".pdp_text_list ul li.active").click(function(){e("#add_text_action").click()}),e(".pdp2_close").click(function(){e("#pdp_design_popup").hide()}),e("#pdp_side_items li").click(function(){if(canvasEvents.clearSelected(),!e(this).hasClass("active")){e("#pdp_side_items li.active").removeClass("active"),e(this).addClass("active");var t=e(this).attr("tab"),i=e("#wrap_inlay").attr("tab"),n=e("#pdp_side_items li[tab="+i+"]").index();e(".product-image.act .wrap_inlay_center").attr("tab")!=t&&(e("#wrap_inlay").attr("tab",t),o[n]=JSON.stringify(a.toJSON(["name","price","tcolor","isrc","icolor","id"])),canvasEvents.reset_canvas(t))}}),e("#rotate-180").click(function(){e("#pdp_rotate_item").slideToggle(400),e(".tab_content:not(#pdp_rotate_item)").slideUp(300)}),e("#pdp_edit_text_tab a").click(function(){e("#pdp_edit_text_tab a.active").removeClass("active"),e(this).addClass("active"),e(".pdp_edit_text_tab_content").slideUp(300),e("#"+e(this).attr("tab")).slideDown(400)}),e(".pdp_edit_font_style li a.text").click(function(){e(this).toggleClass("active"),canvasEvents.editText()}),e("#pdp_search_text").keyup(function(){var t=e(this).val().toUpperCase();e(".pdp_text_list li").each(function(){e(this).text().toUpperCase().indexOf(t)>=0?e(this).show():e(this).hide()})}),e("#pdp_edit_text_style li a.align").click(function(){e("#pdp_edit_text_style li a.align.active").removeClass("active"),e(this).addClass("active"),canvasEvents.editText()}),e("#pdp_font_size_value").ForceNumericOnly(),e("#pdp_font_size_value").change(function(){e("#pdp_font_size_input").val(e(this).val());var t=a.getActiveObject();t&&canvasEvents.editText()}),e(".wrapper_pdp .product-image").click(function(){e(".wrapper_pdp .product-image.act").removeClass("act"),e(this).addClass("act")}),e(".tshirt-size input").change(function(){(""==e(this).val()||e(this).val()<0)&&e(this).val(0),e(this).val(parseInt(e(this).val()))}),e("#design_control .control_tab .tab_main").click(function(){var t=e(this).attr("tab");e("#design_control .control_tab .tab_main.active").removeClass("active"),e(this).addClass("active"),e("."+t).show()}),e(".tab_design_image a").click(function(){e(".tab_design_image .active").removeClass("active"),e(this).addClass("active");var t=e(this).attr("tab-content");e(".content_tab > div").hide(),e(".content_tab ."+t).show()}),e("#add_text_action").click(function(){var t=e("#add_text_input").val(),a=e(".pdp_text_list li.active").text();""!=a?canvasEvents.addText(a):""!=t&&canvasEvents.addText(t)}),e("#add_text_curved_action").click(function(){var t=e("#add_text_input").val(),a=e(".pdp_text_list li.active").text();""!=a?canvasEvents.addTextCurved(a):""!=t&&canvasEvents.addTextCurved(t)}),e("#use_shadow").click(function(){e(this).hasClass("active")?(e(".font_outline_color > div:not(.use_shadow)").hide(),canvasEvents.removeShadow(),e(this).removeClass("active")):(e(".font_outline_color > div").show(),canvasEvents.addShadowItem(),e(this).addClass("active")),e("#font_outline_colorpicker").hide()}),e(".change_font .next_t").click(function(){var t=e(this).prev().val();e(this).prev().val(parseInt(t)+1),canvasEvents.editText()}),e(".change_font .prev_t").click(function(){var t=e(this).next().val();"t-blur"==e(this).next().attr("id")&&0==t||"select_font_size"==e(this).next().attr("id")&&3>t||e(this).next().val(parseInt(t)-1),canvasEvents.editText()}),e("#pdp_edit_text_input").keyup(function(){canvasEvents.editText()}),e("#image_category_list, #select_image").show();e("#image_category_list").height();e("#image_category_list, #select_image").hide(),e(".design_label").click(function(){e("#image_category_list").slideToggle(0)}),e("#font_outline_color").click(function(){e("#font_outline_colorpicker").slideToggle(300)}),e(".inlay_div.color, .color_content_wrap .bt_done").click(function(){e(".color_content").hide(),e("#pdp_color_text").removeClass("pdp_cr_color"),e(".color_display").removeClass("act")}),e("#pdp_color_text li a").click(function(){e("#pdp_color_text li a.active").removeClass("active"),e(this).addClass("active");var t=e(this).css("background-color");canvasEvents.changeColor(t)}),e("#pdp_color_item li a").click(function(){e("#pdp_color_item li a.active").removeClass("active"),e(this).addClass("active");var t=e(this).css("background-color");canvasEvents.changeColor(t)}),e(".color_content li a:not(.selected_color, .bt_done)").click(function(){e(".color_content li a.act").removeClass("act"),e(this).addClass("act");var i;e(this).hasClass("pdp_color_ori")?(i="ori",e("#selected_color").val(""),e(".color_display.act").css("background-color","#FFF")):(i=e(this).css("background-color"),e("#selected_color").val(t(i)),e(".color_display.act").css("background-color",i)),e("a.selected_color").css("background-color",i);var n=a.getActiveObject();n&&(e("#pdp_color_text").hasClass("pdp_cr_color")&&e("#pdp_color_text input").val(t(i)),"text"==n.type&&canvasEvents.editText(),e("#use_shadow").hasClass("active")&&(canvasEvents.editShadowItem(),canvasEvents.renderall()),e("#color_item").hasClass("active")&&canvasEvents.changeColor(i))}),e("#selected_color").change(function(){e("a.selected_color").css("background-color","#"+e(this).val())});var m=e("#send-backwards");m.on("click",function(e){var t=e.getActiveObject();t&&e.sendBackwards(t)});var f=e("#send-to-back");f.on("click",function(e){var t=e.getActiveObject();t&&e.sendToBack(t)});var u=e("#bring-forward");u.on("click",function(e){var t=e.getActiveObject();t&&e.bringForward(t)});var b=e("#bring-to-front");b.on("click",function(e){var t=e.getActiveObject();t&&e.bringToFront(t)});var f=e("#move_to_back");f.on("click",function(){var e=a.getActiveObject();e&&a.sendToBack(e)});var u=e("#move_to_front");u.on("click",function(){var e=a.getActiveObject();e&&a.bringForward(e)}),e("#pdp_flip_x").on("click",canvasEvents.flipX),e("#pdp_flip_y").on("click",canvasEvents.flipY),e("#pdp_poscenter_x").on("click",canvasEvents.centerX),e("#pdp_poscenter_y").on("click",canvasEvents.centerY),e("#delete_item").on("click",canvasEvents.removeObject),e("#pdp_toolbox").on("click",".item_delete",canvasEvents.removeObject),e("#duplicate_item").on("click",canvasEvents.copyObject),e("html").on("click",function(t){var a=e("#pdp_info_item, #canvas-container, #select_image, #add_text, #canvas_area, .pdp_extra_item, #pdp_opacity_item, .color_content, .control_tab, .canvas-container,#pdp_toolbox, .edit_area , #add_text, .p_rotate_wrap > div, .control_area, #edit_item_wrap").has(t.target).length;0===a&&canvasEvents.clearSelected();var i=e("#font_outline_colorpicker, #font_outline_color").has(t.target).length;0===i&&e("#font_outline_colorpicker").slideUp(200);var i=e("#font_color_colorpicker, #font_color, .pdp_color_list").has(t.target).length;0===i&&e("#font_color_colorpicker").slideUp(200)}),a.observe("object:selected",canvasEvents.objectSelected),a.observe("object:modified",canvasEvents.renderall),a.observe("object:modified",canvasEvents.showinfo),a.observe("object:added",canvasEvents.renderall),a.observe("before:selection:cleared",canvasEvents.objectUnselected),e(window).on("keydown",function(t){var a=t.keyCode||t.which;if(37==a)return canvasEvents.moveObject("left"),!1;if(38==a)return canvasEvents.moveObject("up"),!1;if(39==a)return canvasEvents.moveObject("right"),!1;if(40==a)return canvasEvents.moveObject("down"),!1;if(46==a){var i=e("#pdp_edit_text_input").is(":focus");return i||canvasEvents.removeObject(),!1}});var x=e("#extra_options_value").val();if(""==e("#cart_item_id").val()&&""==e("#wishlist_item_id").val()&&e("input[name='pdp_design_string']").length&&""!=e("input[name='pdp_design_string']").val()&&(x=e("input[name='pdp_design_string']").val()),v.addClass("active"),""!=x&&void 0!==x){var w=JSON.parse(x);if(w.length>0)for(i=0;i<w.length;i++)e("#pdp_info_"+w[i].name).val(w[i].json),e(".design-color-image li#"+w[i].color).click()}else PDPsetting.save_first_design();PDPsetting.change_side()},init_cr_item:function(){e(".wrap_inlay .item").length>0&&(e(".design-color-image li.active").length>0?e(".design-color-image li.active").click():e("#list_color li.active").click(),e(".wrap_inlay .item").each(function(){PDPsetting.init_design(e(this))}))},init_design:function(){},hideShareButtons:function(){var t;e("body").on("click",".wrap_pdp_design",function(a){return t=e(a.target).attr("class"),t&&(t.match("pdp_share_buttons")||t.match("at300bs"))?!1:void e(".pdp_share_buttons").hide()})}()}});
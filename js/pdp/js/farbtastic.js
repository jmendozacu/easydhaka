jQuery(document).ready(function(e){jQuery.fn.farbtastic=function(t){e.farbtastic(this,t);return this};jQuery.farbtastic=function(t,n){var t=e(t).get(0);return t.farbtastic||(t.farbtastic=new jQuery._farbtastic(t,n))};jQuery._farbtastic=function(t,n){var r=this;e(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var i=e(".farbtastic",t);r.wheel=e(".wheel",t).get(0);r.radius=84;r.square=100;r.width=194;if(navigator.appVersion.match(/MSIE [0-6]\./)){e("*",i).each(function(){if(this.currentStyle.backgroundImage!="none"){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2);e(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}})}r.linkTo=function(t){if(typeof r.callback=="object"){e(r.callback).unbind("keyup",r.updateValue)}r.color=null;if(typeof t=="function"){r.callback=t}else if(typeof t=="object"||typeof t=="string"){r.callback=e(t);r.callback.bind("keyup",r.updateValue);if(r.callback.get(0).value){r.setColor(r.callback.get(0).value)}}return this};r.updateValue=function(e){if(this.value&&this.value!=r.color){r.setColor(this.value)}};r.setColor=function(e){var t=r.unpack(e);if(r.color!=e&&t){r.color=e;r.rgb=t;r.hsl=r.RGBToHSL(r.rgb);r.updateDisplay()}return this};r.setHSL=function(e){r.hsl=e;r.rgb=r.HSLToRGB(e);r.color=r.pack(r.rgb);r.updateDisplay();return this};r.widgetCoords=function(t){var n,i;var s=t.target||t.srcElement;var o=r.wheel;if(typeof t.offsetX!="undefined"){var u={x:t.offsetX,y:t.offsetY};var a=s;while(a){a.mouseX=u.x;a.mouseY=u.y;u.x+=a.offsetLeft;u.y+=a.offsetTop;a=a.offsetParent}var a=o;var f={x:0,y:0};while(a){if(typeof a.mouseX!="undefined"){n=a.mouseX-f.x;i=a.mouseY-f.y;break}f.x+=a.offsetLeft;f.y+=a.offsetTop;a=a.offsetParent}a=s;while(a){a.mouseX=undefined;a.mouseY=undefined;a=a.offsetParent}}else{var u=r.absolutePosition(o);n=(t.pageX||0*(t.clientX+e("html").get(0).scrollLeft))-u.x;i=(t.pageY||0*(t.clientY+e("html").get(0).scrollTop))-u.y}return{x:n-r.width/2,y:i-r.width/2}};r.mousedown=function(t){if(!document.dragging){e(document).bind("mousemove",r.mousemove).bind("mouseup",r.mouseup);document.dragging=true}var n=r.widgetCoords(t);r.circleDrag=Math.max(Math.abs(n.x),Math.abs(n.y))*2>r.square;r.mousemove(t);return false};r.mousemove=function(e){var t=r.widgetCoords(e);if(r.circleDrag){var n=Math.atan2(t.x,-t.y)/6.28;if(n<0)n+=1;r.setHSL([n,r.hsl[1],r.hsl[2]])}else{var i=Math.max(0,Math.min(1,-(t.x/r.square)+.5));var s=Math.max(0,Math.min(1,-(t.y/r.square)+.5));r.setHSL([r.hsl[0],i,s])}return false};r.mouseup=function(){e(document).unbind("mousemove",r.mousemove);e(document).unbind("mouseup",r.mouseup);document.dragging=false};r.updateDisplay=function(){var t=r.hsl[0]*6.28;e(".h-marker",i).css({left:Math.round(Math.sin(t)*r.radius+r.width/2)+"px",top:Math.round(-Math.cos(t)*r.radius+r.width/2)+"px"});e(".sl-marker",i).css({left:Math.round(r.square*(.5-r.hsl[1])+r.width/2)+"px",top:Math.round(r.square*(.5-r.hsl[2])+r.width/2)+"px"});e(".color",i).css("backgroundColor",r.pack(r.HSLToRGB([r.hsl[0],1,.5])));if(typeof r.callback=="object"){e(r.callback).css({backgroundColor:r.color,color:r.hsl[2]>.5?"#000":"#fff"});e(r.callback).each(function(){if(this.value&&this.value!=r.color){this.value=r.color}})}else if(typeof r.callback=="function"){r.callback.call(r,r.color)}};r.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=r.absolutePosition(e.offsetParent);t.x+=n.x;t.y+=n.y}return t};r.pack=function(e){var t=Math.round(e[0]*255);var n=Math.round(e[1]*255);var r=Math.round(e[2]*255);return"#"+(t<16?"0":"")+t.toString(16)+(n<16?"0":"")+n.toString(16)+(r<16?"0":"")+r.toString(16)};r.unpack=function(e){if(e.length==7){return[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]}else if(e.length==4){return[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]}};r.HSLToRGB=function(e){var t,n,r,i,s;var o=e[0],u=e[1],a=e[2];n=a<=.5?a*(u+1):a+u-a*u;t=a*2-n;return[this.hueToRGB(t,n,o+.33333),this.hueToRGB(t,n,o),this.hueToRGB(t,n,o-.33333)]};r.hueToRGB=function(e,t,n){n=n<0?n+1:n>1?n-1:n;if(n*6<1)return e+(t-e)*n*6;if(n*2<1)return t;if(n*3<2)return e+(t-e)*(.66666-n)*6;return e};r.RGBToHSL=function(e){var t,n,r,i,s,o;var u=e[0],a=e[1],f=e[2];t=Math.min(u,Math.min(a,f));n=Math.max(u,Math.max(a,f));r=n-t;o=(t+n)/2;s=0;if(o>0&&o<1){s=r/(o<.5?2*o:2-2*o)}i=0;if(r>0){if(n==u&&n!=a)i+=(a-f)/r;if(n==a&&n!=f)i+=2+(f-u)/r;if(n==f&&n!=u)i+=4+(u-a)/r;i/=6}return[i,s,o]};e("*",i).mousedown(r.mousedown);r.setColor("#000000");if(n){r.linkTo(n)}}})
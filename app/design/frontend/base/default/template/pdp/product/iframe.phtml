<?php 
$request = $this->getRequest()->getParams();
$jsonFile = "";
if (isset($request['json']) && $request['json'] != "") {
	$jsonFile = "json/" . $request['json'];
}
?>
<style>
	.loader {
		background: url("<?php echo $this->getJsUrl("pdp/images/gif-load.gif"); ?>") no-repeat scroll center center rgba(0, 0, 0, 0);
    	text-align: center;
    	margin-top: 26px;
    	padding: 15px;
	}
	/* Update CSS for Iframe */
	.pdc_design_panel {
	    background: none repeat scroll 0 0 #fff;
	    display: inline-block;
	    padding: 0;
	    width: 100%;
	}
	.iframe-container #close_iframe {
	  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAFNUlEQVRIS51WWWwbVRQ9z2u8b0nqxLGbpe7iAFULgg/SSJUq/gCp0DhFapsUCZAiUtHyBy1Q8QclxU2qRiC1f2Tjkz8qRaEVitRWVKmTdMnSNJvjdTz2OPY4fmjGY8cDER/Mx8ybN+eec9+79747BADYru4hEOKHSiG8/q+LClbiDUB+CxR02HLrVidJdHUNqRpsfoXT9N/EtGRdAZOxSvMSbiuUAr/MDBOmu5uqDzfIyGkqBxpioWi2y0UlYyq4WqFH0zkgmwex6WT43F9rIIkPz1LNwbqygQDemloH8gWQWiMUXkfRaMcVUFCORyG4IUIUvhoQvVrCA9npDZC4IPDSriJHOof8ow1ojrwJlc8H7vogFDUGKPfY5QKS95TLIT8dgdLthrLRg9wfd6A6UA2iK4pszoRBYme7qba1FoVYBvm5GDRtbdD3fCwCcuMTSA8MQrXbCqXTIN8Wjgc/UyQ3fv0liEEPbmBQFFHvd4DoVOBmoyCR7i6q89WgkOaRlQwskoEgkh2fQGpgEOomK1QOvShc4HhkH0ehPdIGo+RMJVZVq4faZUL6aQxko6uLGg5Ui94VuBwys1HRK9s3F0WvxKWOTyDZfwPaRiuUOhUyT2LQtrfB3PNJOagljNqug9ZjFufZZ3GQUNcZatwrBRIUW1we6ScxVLW3wVpBkBmfQKL/hmioP9oOyw7fNLYq6Nymcj6w8wmQtTNnqNkrD+IWxyM5F4eu/QjsFUSJn2+ikOZgP9dT9jw9PoF4/w0YXEZorFUV1QYwCwzIyunT1NpilWUiZRPgwwlE7i/BcOwY6q9+t2MRJobHEPrqW9hbndC5a0BMFlkVxhdZkBenTlFbkxXgsyhEN1CIx4CtfDGL0jxCwQgs7x2H++r3MpHVS5cR+ekmHM0WGKuFAqOAQglidUBRXQOoNYgtsSCLHR3UbuBQSESlNNyu0mSYQ3iOQe1HZ9Fw+ZJM4Pm5zxEdHoPLZ4dWr5IXo6BlcyCaM4EEvV7qOmCXArNNzkQyCM0zaA5cQbX//R23aP7cBcRGf4Xba4W26t8iy/MMyFTLHtqwrxiD0vkSDaWxvpyCN3AFtf4TZfKnvefFsTfwQ3nuWe8FREbH0NhsQZVWLvJ8MQnysLmZevbYykfB0lIS8VgG+wN92NW5TT7bex6RkTFsFQrYF+iDs+Lb497zCI+MocVjLopIp+zCCxbkQWMTbRKCDGBhmUE0vonWa32o6+woexn89DOER0ax12MFt5nH4joL37U+1FdgJo++BW56GntdZug1RZG5tSTIvd2NtMVjwcI6i/Uoh1f6f4TrZJGcZ5KY+eIi1kdG0eqyQi9tQZjZxNwGi5f7r6LhpF/E5pkkJt89jnRwGj6nBQa1Ck83WJBJ927qrTcjnc3j4Ys46vwncHggAJ5hcPft40hPT+NgnRWG0tKlkzTEZvA4yuJQfwCeD4oiD3p6sTY0itZqEywaNWajLMifLg/d5zSLS0pledxfjcPV2YHE1CPRm1edVhg16mKMSk1Ges5Ek1jlNvHa9WsI37mLlV9GcLjaApNKKQoG4ymQO3Vu6qsxlY3ZLI/JUFwEvFFrg0ldCpqUZqVeIDwp8CiRxEomC5WC4HWbQC5kUtGZqWQK5HZtPT3kEEp828PIZg5qQmCuJC+3SAlXsZpgKgW3VguzQC4JC4N7qRTI7zX1Q3VVGr9Tq90W+cdWlI/HCuPKniwbS7m3yuewkssOE+H9N9uuIULgVxEi71qyzi4v5h3+Mcq1mqcUlNLhd5hw59/wX2cFBH5lggAAAABJRU5ErkJggg==") no-repeat scroll center center transparent;
	  cursor: pointer;
	  height: 30px;
	  position: absolute;
	  right: 10px;
	  top: 10px;
	  width: 30px;
	  z-index: 1000;
	}
	.iframe-container {
	  box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
	}
	body {
	  background: none repeat scroll 0 0 #00aeef;
	  display: block;
	  margin: 0;
	  padding: 2em;
	  position: relative;
	}
</style>
<div class="iframe-container" style="display: none;">
	<button style="display: none;" id="get_design_content">Get Design Page</button>
	<span id="close_iframe" class="close"></span>
	<div class="pdc_design_panel"></div>
</div>
<div class="loader"></div>
<script src="<?php echo $this->getJSUrl('pdp/js/jquery.min.js') ?>"></script>
<script src="<?php echo $this->getJSUrl('pdp/js/farbtastic.js') ?>"></script>
<script src="<?php echo $this->getJSUrl('pdp/js/jquery.nouislider.js') ?>"></script>
<script src="<?php echo $this->getJSUrl('pdp/js/owl.carousel.js') ?>"></script>
<script src="<?php echo $this->getJSUrl('pdp/js/fabric.js') ?>"></script>
<script src="<?php echo $this->getJSUrl('pdp/js/jquery.mCustomScrollbar.concat.min.js') ?>"></script>
<script>
	jQuery(function($) {
		var mainWindow = top.document;
		var baseUrl = $("#base_url", mainWindow).val(),
			_ifMarginTop = "10px", 
			productId = "<?php echo $request['product-id']?>";
		LoadDesign = {
			pendingTime : 0,
			baseUrl : null,
			init : function() {
				setTimeout(function() {
					LoadDesign.getDesignPage();
				}, LoadDesign.pendingTime);
			},
			getDesignPage : function() {
				var designUrl = baseUrl + "pdp/view/getDesignPage/product-id/" + productId + "/area/customize/" + "<?php echo $jsonFile?>";
				LoadDesign.sendRequest(designUrl, function(response) {
					if (response != "") {
						$(".pdc_design_panel").html(response);
						LoadDesign.resizeIframe();
					}
				});
			},
			sendRequest : function(url, callback) {
				$.ajax({
					type : "GET",
					url : url,
					beforeSend : function () {
						//console.log("Sending request...");
						$(".pdp_loading").show();
					},
					success : function(data) {
						callback(data);
						$(".pdp_loading").hide();
					}
				});
			},
			resizeIframe : function() {
				$("#pdc_iframe", mainWindow).css({
					"width": "100%",
					"height" : "100%",
					"left" : "0",
					"top" : "0",
					"right" : "0",
					"background" : "white"
				});
				LoadDesign.readyToDesign();
			},
			closeIframe : function() {
				$("#close_iframe").click(function() {
					$("#pdc_iframe", mainWindow).css({"top" : "-100000px"});
					$(".catalog-product-view", mainWindow).css({"overflow" : "inherit"});
				});
			}(),
			readyToDesign : function() {
				$(".loader").hide();
				$(".iframe-container").show();
				top.document.body.scrollTop = top.document.documentElement.scrollTop = 0;
			},
			showSampleImage : function() {
				if($("#sample_images", mainWindow).length) {
					var sampleImageStr = $("#sample_images", mainWindow).val();
					if (sampleImageStr) {
						var sampleImageJson = JSON.parse(sampleImageStr);
						if (sampleImageJson[0].image_result) {
							$('.product-view .product-img-box .product-image img', mainWindow).attr('src', sampleImageJson[0].image_result);
							//Magento 1.9.1 rwd packgae - zoom elevateZoom
							if(top.window.ProductMediaManager !== undefined) {
								top.window.ProductMediaManager.init();
							}
						}
						if (sampleImageJson.length > 1) {
							$('.more-views', mainWindow).remove();
							if($('.product-view .product-img-box .pdp_more_view', mainWindow).length == 0){
								$('.product-view .product-img-box', mainWindow).append('<div class="more-views"><h2>More Views</h2><ul class="pdp_more_view"></ul></div>');
							}else{
								$('.pdp_more_view', mainWindow).html('');
							}
							$.each(sampleImageJson, function(index, image) {
								$('.pdp_more_view', mainWindow).append('<li style="padding: 0px 3px;"><img title="' + image.side_name + '" width="56" height="56" src="'+ image.image_result +'" /></li>');
							});
							$('.pdp_more_view li img', mainWindow).click(function(){
								$('.product-view .product-img-box .product-image img', mainWindow).attr('src',$(this).attr('src')); 
								//Magento 1.9.1 rwd packgae - zoom elevateZoom
								if(top.window.ProductMediaManager !== undefined) {
									top.window.ProductMediaManager.init();
								}
							});
						}
					}
				}
			}(),
			reloadPrice : function() {
				/********************************** RELOAD PRICE **********************************/
				if ($("#product_price_config", mainWindow).length) {
					var productPriceConfig = JSON.parse($("#product_price_config", mainWindow).val());
					if (productPriceConfig.productId === undefined) {
						return false;
					}
					var extraPrice = 0;
					if ($("#extra_options_value", mainWindow).length && $("#extra_options_value", mainWindow).val() != "") {
						var extraOptionsValue = JSON.parse($("#extra_options_value", mainWindow).val());
						var sampleCost = extraOptionsValue.items[0].final_price;
						if (sampleCost) {
							extraPrice = parseFloat(sampleCost); 
						}
					}
					productPriceConfig.productPrice = productPriceConfig.productPrice + extraPrice;
					productPriceConfig.productOldPrice = productPriceConfig.productOldPrice + extraPrice;
					parent.optionsPrice = new parent.Product.OptionsPrice(productPriceConfig);
					try {
						parent.optionsPrice.reload();
					} catch(error) {
						console.log(error);
					}
				}
				/********************************** End RELOAD PRICE **********************************/
			}(),
			getDesignPageClick : function() {
				$("#get_design_content").click(function() {
					top.document.body.scrollTop = top.document.documentElement.scrollTop = 0;
					$(".catalog-product-view", mainWindow).css({"overflow" : "hidden"});
					if($(this).hasClass("loaded")) {
						//Show iframe
						$("#pdc_iframe", mainWindow).css({
							"top" : "0"
						});
						return false;
					} else {
						var _initIframeW = 300;
						$("#pdc_iframe", mainWindow).css({
							"top" : ($(top.window).height() / 3) + "px",
							"left" : ($(top.window).width() - _initIframeW) / 2 + "px"
						});
					}
					$(this).addClass("loaded");
					LoadDesign.init();
				});
			}(),
			autoClickCustomBtn : function() {
				if($("#pdp_design_action", mainWindow).val() == "design") {
					$("#get_design_content").click();
				}
			}
 		}
 		LoadDesign.autoClickCustomBtn();
	});
</script>